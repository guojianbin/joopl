module.exports = function (grunt) {
  grunt.registerMultiTask(
  	"jooplanalyzer", "Analyzes files recursively from a base directory and creates a 'moduleinfo.js' file in the base directory which defines file dependencies based on class hierarchy, enumerations and their usage across the source code", 
	function () {
		var done = this.async();
		var classes = require("../../../node_modules/joopl-analyzer/bin/classes.js");

		if(typeof this.data == "undefined") {
			grunt.log.error("No configuration given! Double-check your Gruntfile.js and set the whole options for this task!");
		}

		if(!this.data.hasOwnProperty("baseDirectory")) {
			grunt.log.error("No configuration given! Double-check your Gruntfile.js and set the whole options for this task!");
		}

		grunt.log.writeln("\n*********************************\n");
		grunt.log.writeln("\tjOOPL Analyzer ");
		grunt.log.writeln("\thttp://mfidemraizer.github.io/joopl/");
		grunt.log.writeln();
		grunt.log.writeln("\tThis program is distributed under \n\tApache License 2.0\n\t(http://www.apache.org/licenses/LICENSE-2.0.html)\n");
		grunt.log.writeln("\t(c) Matias Fidemraizer\n\t(https://www.linkedin.com/in/mfidemraizer)\n");
		grunt.log.writeln("*********************************\n\n");
		grunt.log.writeln("jOOPL Analyzer starting from '%s' base directory...", this.data.baseDirectory);

		var analyzer = new classes.DependencyAnalyzer();
		analyzer.start({ baseDirectory: this.data.baseDirectory }).then(function() {
			done(true);
		});
  });
};